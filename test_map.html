<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Test - Transform Fix Verification</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 2rem;
            background: #0b0d18;
            color: white;
            line-height: 1.6;
        }
        .test-section {
            background: #1a1d2e;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .pass { color: #4ade80; }
        .fail { color: #ef4444; }
        .info { color: #60a5fa; }
        button {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        button:hover {
            background: rgba(255,255,255,0.15);
        }
        code {
            background: rgba(0,0,0,0.3);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        #results {
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <h1>üß™ Interactive Map - Transform Fix Test</h1>

    <div class="test-section">
        <h2>üìã Pre-flight Checklist</h2>
        <button onclick="checkFiles()">Check Files</button>
        <button onclick="checkCSS()">Check CSS</button>
        <button onclick="checkJS()">Check JavaScript</button>
        <div id="results"></div>
    </div>

    <div class="test-section">
        <h2>üéØ Quick Tests</h2>
        <button onclick="window.open('index_map.html', '_blank')">Open Map</button>
        <button onclick="testTransform()">Test Transform Logic</button>
        <p class="info">
            Open the map in a new tab and verify:
            <br>‚úì Regions appear in correct positions
            <br>‚úì Click to select (zooms 1.05x)
            <br>‚úì Other regions fade to gray
            <br>‚úì Click again to deselect
        </p>
    </div>

    <div class="test-section">
        <h2>üìñ Documentation</h2>
        <ul>
            <li><a href="QUICKSTART_MAP.md" style="color: #60a5fa">QUICKSTART_MAP.md</a> - 30-second setup</li>
            <li><a href="MAP_README.md" style="color: #60a5fa">MAP_README.md</a> - Full documentation</li>
            <li><a href="TRANSFORM_FIX.md" style="color: #60a5fa">TRANSFORM_FIX.md</a> - Technical details</li>
            <li><a href="FIXED_SUMMARY.md" style="color: #60a5fa">FIXED_SUMMARY.md</a> - What was fixed</li>
            <li><a href="INTEGRATION_GUIDE.md" style="color: #60a5fa">INTEGRATION_GUIDE.md</a> - Integration with star story</li>
        </ul>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const icon = type === 'pass' ? '‚úÖ' : type === 'fail' ? '‚ùå' : '‚ÑπÔ∏è';
            results.innerHTML += `<span class="${type}">${icon} ${message}</span>\n`;
        }

        function clearLog() {
            document.getElementById('results').innerHTML = '';
        }

        async function checkFiles() {
            clearLog();
            log('Checking files...', 'info');

            const files = [
                'index_map.html',
                'styles_map.css',
                'app_map.js',
                'assets/KoreaMap.svg'
            ];

            for (const file of files) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        log(`${file} exists`, 'pass');
                    } else {
                        log(`${file} missing (${response.status})`, 'fail');
                    }
                } catch (error) {
                    log(`${file} error: ${error.message}`, 'fail');
                }
            }
        }

        async function checkCSS() {
            clearLog();
            log('Checking CSS...', 'info');

            try {
                const response = await fetch('styles_map.css');
                const css = await response.text();

                // Check for forbidden CSS transform
                if (css.includes('.region') && css.includes('transform:') &&
                    !css.includes('NO CSS transform') && !css.includes('NO transform')) {
                    log('WARNING: CSS transform found in .region', 'fail');
                    log('This will cause conflicts with SVG transform!', 'fail');
                } else {
                    log('CSS is clean (no transform conflicts)', 'pass');
                }

                // Check for transition
                if (css.includes('transition:') && css.includes('opacity')) {
                    log('Transitions configured correctly', 'pass');
                } else {
                    log('Transitions might be missing', 'info');
                }

                // Check for .active and .fade classes
                if (css.includes('.region.active')) {
                    log('.region.active class found', 'pass');
                } else {
                    log('.region.active class missing', 'fail');
                }

                if (css.includes('.region.fade')) {
                    log('.region.fade class found', 'pass');
                } else {
                    log('.region.fade class missing', 'fail');
                }

            } catch (error) {
                log(`Error reading CSS: ${error.message}`, 'fail');
            }
        }

        async function checkJS() {
            clearLog();
            log('Checking JavaScript...', 'info');

            try {
                const response = await fetch('app_map.js');
                const js = await response.text();

                // Check for originalTransforms
                if (js.includes('originalTransforms')) {
                    log('originalTransforms map found', 'pass');
                } else {
                    log('originalTransforms map missing', 'fail');
                }

                // Check for applyScaleTransform
                if (js.includes('applyScaleTransform')) {
                    log('applyScaleTransform function found', 'pass');
                } else {
                    log('applyScaleTransform function missing', 'fail');
                }

                // Check for restoreOriginalTransform
                if (js.includes('restoreOriginalTransform')) {
                    log('restoreOriginalTransform function found', 'pass');
                } else {
                    log('restoreOriginalTransform function missing', 'fail');
                }

                // Check for getBBox
                if (js.includes('getBBox')) {
                    log('getBBox() usage found (correct)', 'pass');
                } else {
                    log('getBBox() not found (might be issue)', 'info');
                }

                // Check for setAttribute('transform')
                if (js.includes("setAttribute('transform'")) {
                    log("setAttribute('transform') found (correct)", 'pass');
                } else {
                    log("setAttribute('transform') missing", 'fail');
                }

            } catch (error) {
                log(`Error reading JS: ${error.message}`, 'fail');
            }
        }

        function testTransform() {
            clearLog();
            log('Transform Logic Test', 'info');
            log('', 'info');

            // Simulate transform operations
            const originalTransform = 'translate(100,200) rotate(15)';
            const scale = 1.05;

            // Simulate bbox
            const bbox = { x: 100, y: 150, width: 200, height: 300 };
            const cx = bbox.x + bbox.width / 2;  // 200
            const cy = bbox.y + bbox.height / 2; // 300

            const scaleTransform = ` translate(${cx},${cy}) scale(${scale}) translate(${-cx},${-cy})`;
            const finalTransform = originalTransform + scaleTransform;

            log('Original transform:', 'info');
            log(`  ${originalTransform}`, 'info');
            log('', 'info');
            log('Calculated center:', 'info');
            log(`  cx: ${cx}, cy: ${cy}`, 'info');
            log('', 'info');
            log('Scale transform:', 'info');
            log(`  ${scaleTransform.trim()}`, 'info');
            log('', 'info');
            log('Final transform (active):', 'pass');
            log(`  ${finalTransform}`, 'pass');
            log('', 'info');
            log('On deselect, restore to:', 'pass');
            log(`  ${originalTransform}`, 'pass');
        }

        // Run initial checks
        window.addEventListener('DOMContentLoaded', () => {
            log('Test page loaded. Click buttons to run checks.', 'info');
        });
    </script>
</body>
</html>
